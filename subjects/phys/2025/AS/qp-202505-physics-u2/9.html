<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Physics Q9: Energy Levels</title>
    
    <!-- 引入公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- V3.0 标准布局 --- */
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 400px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        .canvas-container { 
            width: 100%; height: 0; 
            padding-bottom: 60%; 
            position: relative; background: #2c3e50; 
            border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
        }
        @media (max-width: 1000px) { .canvas-container { padding-bottom: 80%; } }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;}
        button.action-btn.secondary { background-color: #9b59b6; }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        .step-box { 
            border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; 
            background: #fff; border-radius: 8px; border-left: 4px solid #ccc;
            transition: all 0.3s;
        }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .math-eq { 
            font-family: 'Times New Roman', serif; font-size: 1.1em;
            color: #2c3e50; background: #f9f9f9; border: 1px solid #eee;
            padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block;
        }
        .highlight { color: #d35400; font-weight: bold; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：能级图演示 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9708 Physics / Unit 2 / Q9</h3>
                
                <div style="background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333;">
                    <strong>Given:</strong> Hydrogen energy levels (Fig 12).<br>
                    <strong>09.1</strong> Explain line spectra evidence.<br>
                    <strong>09.2</strong> Find transition for $\lambda = 656$ nm.<br>
                    <strong>09.3</strong> Incident photon $12.75$ eV. Find number of emission lines.
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:10px; right:10px; color:#fff; font-size:12px; text-align:right;">
                        <span style="color:#e74c3c">● Electron</span><br>
                        <span style="color:#f1c40f">↝ Photon</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="action-btn" onclick="animQ9_2()">Show Q9.2 (656nm)</button>
                    <button class="action-btn secondary" onclick="animQ9_3()">Show Q9.3 (Count Lines)</button>
                    <button class="action-btn" style="background:#95a5a6" onclick="resetSim()">Reset</button>
                </div>
            </div>
        </div>

        <!-- 右侧：解题步骤 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <!-- Q9.1 -->
                <div class="step-box">
                    <strong>09.1 Line Spectra Evidence (3 marks)</strong><br>
                    1. Atoms absorb/emit photons to move between energy levels.<br>
                    2. The energy of the photon is equal to the difference in energy levels ($hf = E_2 - E_1$).<br>
                    3. Since only specific frequencies (line spectra) are seen, it implies the energy gaps are <strong>discrete (specific values)</strong>.
                </div>

                <!-- Q9.2 -->
                <div id="step2" class="step-box">
                    <strong>09.2 Find Transition (4 marks)</strong><br>
                    Given $\lambda = 656$ nm.<br>
                    Step 1: Calculate Energy (J)<br>
                    $E = \frac{hc}{\lambda} = \frac{6.63 \times 10^{-34} \times 3.00 \times 10^8}{656 \times 10^{-9}}$<br>
                    $E \approx 3.03 \times 10^{-19}$ J<br><br>
                    Step 2: Convert to eV<br>
                    $E_{eV} = \frac{3.03 \times 10^{-19}}{1.60 \times 10^{-19}} \approx \mathbf{1.89 \text{ eV}}$<br><br>
                    Step 3: Find match in Diagram<br>
                    Check difference: $-1.51 - (-3.39) = 1.88 \text{ eV}$<br>
                    <span class="highlight">Transition: Level 3 to Level 2</span>
                </div>

                <!-- Q9.3 -->
                <div id="step3" class="step-box" style="border-left-color: #9b59b6;">
                    <strong>09.3 Count Lines (1 mark)</strong><br>
                    Start at Level 1 (Ground, -13.6 eV).<br>
                    Absorb 12.75 eV: $E_{new} = -13.6 + 12.75 = -0.85$ eV.<br>
                    Matches <strong>Level 4</strong>.<br><br>
                    Possible transitions downwards from Level 4:<br>
                    4$\to$3, 4$\to$2, 4$\to$1<br>
                    3$\to$2, 3$\to$1<br>
                    2$\to$1<br>
                    <span class="highlight">Total = 6 different energies</span>
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Energy Levels Data
        // Visual Y positions (Schematic, not linear scale)
        const levels = [
            { n: 5, ev: -0.54, yRatio: 0.15 },
            { n: 4, ev: -0.85, yRatio: 0.25 },
            { n: 3, ev: -1.51, yRatio: 0.40 },
            { n: 2, ev: -3.39, yRatio: 0.60 },
            { n: 1, ev: -13.6, yRatio: 0.90 }
        ];

        let animationState = 'IDLE'; // IDLE, Q9_2, Q9_3
        let particles = []; // Photons
        let electron = { level: 1, x: 0, y: 0, targetLevel: 1 };

        function resize() {
            if(!canvas.parentElement) return;
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            if(animationState === 'IDLE') drawStatic();
        }
        window.addEventListener('resize', resize);

        function resetSim() {
            animationState = 'IDLE';
            particles = [];
            electron = { level: 1, x: 0, y: 0, targetLevel: 1 }; // Reset to ground
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            drawStatic();
        }

        function animQ9_2() {
            resetSim();
            animationState = 'Q9_2';
            electron.level = 3; // Start at level 3
            highlightStep(2);
            
            // Animation sequence:
            // 1. Electron at L3
            // 2. Drops to L2
            // 3. Emits Red Photon
            
            animateTransition(3, 2, '#e74c3c', '656nm');
        }

        function animQ9_3() {
            resetSim();
            animationState = 'Q9_3';
            highlightStep(3);
            
            // Sequence:
            // 1. Absorb photon from L1 to L4
            // 2. Show all paths from L4 down
            
            animateExcitation(1, 4, () => {
                // After excitation, show all cascade paths
                drawAllTransitions(4);
            });
        }
        
        function highlightStep(id) {
            document.getElementById('step'+id).classList.add('active');
        }

        // --- Drawing Helpers ---
        
        function getY(levelNum) {
            const lvl = levels.find(l => l.n === levelNum);
            return canvas.height * lvl.yRatio;
        }

        function drawStatic() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawLevels();
            // Draw electron at ground state if idle
            if(animationState === 'IDLE') {
                drawElectron(canvas.width/2, getY(1));
            }
        }

        function drawLevels() {
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            const w = canvas.width;
            
            levels.forEach(l => {
                const y = canvas.height * l.yRatio;
                
                // Line
                ctx.beginPath();
                ctx.moveTo(w * 0.2, y);
                ctx.lineTo(w * 0.8, y);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Labels
                ctx.fillStyle = '#ddd';
                ctx.fillText(`n=${l.n}`, w * 0.85, y + 4);
                ctx.textAlign = 'right';
                ctx.fillText(`${l.ev} eV`, w * 0.15, y + 4);
                ctx.textAlign = 'left';
            });
        }

        function drawElectron(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI*2);
            ctx.fillStyle = '#e74c3c'; // Red electron
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function drawPhoton(x, y, color, text) {
            ctx.beginPath();
            // Wavy line
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.moveTo(x, y);
            for(let i=0; i<30; i++) {
                ctx.lineTo(x + i*2, y + Math.sin(i)*5);
            }
            ctx.stroke();
            
            // Arrow
            ctx.beginPath();
            ctx.moveTo(x+60, y);
            ctx.lineTo(x+55, y-3);
            ctx.lineTo(x+55, y+3);
            ctx.fillStyle = color;
            ctx.fill();
            
            if(text) {
                ctx.fillStyle = color;
                ctx.fillText(text, x+10, y-10);
            }
        }

        // --- Animation Logic ---

        function animateTransition(fromN, toN, color, label) {
            let startTime = null;
            const startY = getY(fromN);
            const endY = getY(toN);
            const x = canvas.width / 2;
            
            function loop(time) {
                if (!startTime) startTime = time;
                const progress = (time - startTime) / 1000; // 1s duration
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawLevels();
                
                if (progress < 1) {
                    // Falling
                    const currentY = startY + (endY - startY) * easeInOut(progress);
                    drawElectron(x, currentY);
                } else {
                    // Landed
                    drawElectron(x, endY);
                    // Emit photon moving right
                    const photonX = x + (progress - 1) * 100;
                    if (photonX < canvas.width) {
                        drawPhoton(photonX, endY, color, label);
                    }
                }
                
                if (progress < 2.5 && animationState === 'Q9_2') {
                    requestAnimationFrame(loop);
                }
            }
            requestAnimationFrame(loop);
        }

        function animateExcitation(fromN, toN, callback) {
            let startTime = null;
            const startY = getY(fromN);
            const endY = getY(toN);
            const x = canvas.width / 2;
            
            function loop(time) {
                if (!startTime) startTime = time;
                const progress = (time - startTime) / 1000; 
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawLevels();
                
                if (progress < 0.5) {
                    // Photon incoming
                    const photonX = x - 100 + progress * 200;
                    drawPhoton(photonX, startY, '#f1c40f', '12.75eV');
                    drawElectron(x, startY);
                } else if (progress < 1.5) {
                    // Jump Up
                    const jumpProg = (progress - 0.5);
                    const currentY = startY + (endY - startY) * easeInOut(jumpProg);
                    drawElectron(x, currentY);
                } else {
                    drawElectron(x, endY);
                    if(callback) callback();
                    return; // End this loop, hand over to callback
                }
                
                if (animationState === 'Q9_3') requestAnimationFrame(loop);
            }
            requestAnimationFrame(loop);
        }

        function drawAllTransitions(fromN) {
            // Static visualization of all paths from N=4
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawLevels();
            
            const xBase = canvas.width * 0.3;
            const gap = canvas.width * 0.1;
            
            // Lines to draw: 4->3, 4->2, 4->1, 3->2, 3->1, 2->1
            const lines = [
                {s:4, e:3, x:1}, {s:4, e:2, x:2}, {s:4, e:1, x:3},
                {s:3, e:2, x:1.5}, {s:3, e:1, x:2.5},
                {s:2, e:1, x:1.8} // offset x to avoid clutter
            ];
            
            ctx.lineWidth = 2;
            lines.forEach((l, i) => {
                const y1 = getY(l.s);
                const y2 = getY(l.e);
                const x = xBase + i * (canvas.width * 0.08); // Spread out
                
                // Draw arrow line
                ctx.beginPath();
                ctx.moveTo(x, y1);
                ctx.lineTo(x, y2);
                ctx.strokeStyle = `hsl(${i * 60}, 70%, 60%)`; // Rainbow colors
                ctx.stroke();
                
                // Arrow head
                ctx.beginPath();
                ctx.moveTo(x, y2);
                ctx.lineTo(x-3, y2-10);
                ctx.lineTo(x+3, y2-10);
                ctx.fillStyle = ctx.strokeStyle;
                ctx.fill();
            });
            
            // Label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Total: ${lines.length} Transitions`, canvas.width/2, 30);
            
            // Draw electron at top
            drawElectron(canvas.width/2, getY(4));
        }

        function easeInOut(t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t; }

        // Init
        setTimeout(resize, 200);
    </script>
</body>
</html>