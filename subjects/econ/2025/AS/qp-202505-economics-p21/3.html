<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Econ Q3: Subsidy</title>
    
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 450px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        .orig-img { max-width: 100%; display: block; margin-bottom: 10px; border: 1px solid #eee; }

        .canvas-container { 
            width: 100%; height: 450px; 
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; flex-direction: column; gap: 12px; background: #f8f9fa; padding: 15px; border-radius: 8px; border:1px solid #eee; }
        .control-row { display: flex; align-items: center; gap: 10px; justify-content: space-between; }
        
        button.action-btn { 
            flex: 1; background-color: #fff; color: #333; border: 1px solid #ccc; 
            padding: 8px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size:13px;
        }
        button.action-btn.active { background-color: #2980b9; color: white; border-color: #2980b9; }
        button.exam-btn { background-color: #27ae60; color: white; border: none; flex: 2; transition: transform 0.1s;}
        button.exam-btn:active { transform: scale(0.98); }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right: 5px; }
        .tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 15px; }
        .tab-item { padding: 10px 15px; cursor: pointer; font-weight: bold; color: #7f8c8d; border-bottom: 2px solid transparent; margin-bottom: -2px; font-size: 14px; }
        .tab-item.active { color: #3498db; border-bottom-color: #3498db; }
        
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        
        .explanation p { margin-bottom: 8px; line-height: 1.6; font-size: 14px; color: #444; }
        .term { color: #d35400; font-weight: bold; }
        .highlight { background-color: #fff3cd; padding: 1px 4px; border-radius: 3px; font-weight:bold; color:#d35400; }
        h4 { margin: 15px 0 8px 0; color: #2c3e50; border-left: 4px solid #3498db; padding-left: 8px; font-size: 15px; }
        .problem-text { background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333; }
        
        /* 范文优化样式 */
        .model-section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed #ccc; }
        .model-header { font-size: 16px; font-weight: bold; color: #2980b9; margin-bottom: 8px; }
        .model-sub { font-weight: bold; color: #555; display: block; margin-top: 8px; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9708 Econ / Section B / Q3</h3>
                <div class="problem-text">
                    <img src="q3_orig.png" class="orig-img" onerror="this.style.display='none'">
                    <p><strong>(a)</strong> With the help of a diagram, explain how changes in a subsidy can influence the price and quantity sold of a product in a market and consider how expenditure on a subsidy is affected by the price elasticity of demand for the product. [8]</p>
                    <p><strong>(b)</strong> Assess whether an increase in the tax on a demerit good is always the best way to reduce the consumption of such a product. [12]</p>
                </div>
                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                </div>
                <div class="controls">
                    <div class="control-row">
                        <span style="font-weight:bold; font-size:14px;">PED:</span>
                        <button class="action-btn active" id="btnInelastic" onclick="setPED(0.5)">Inelastic (<1)</button>
                        <button class="action-btn" id="btnElastic" onclick="setPED(1.5)">Elastic (>1)</button>
                    </div>
                    <div class="control-row">
                        <span style="font-weight:bold; font-size:14px;">Subsidy:</span>
                        <input type="range" id="sliderSubsidy" min="0" max="100" value="0" style="flex:1; cursor:pointer;" oninput="manualMode()">
                    </div>
                    <div class="control-row">
                        <button class="action-btn exam-btn" onclick="showExamMode()">★ Show Exam Diagram</button>
                        <button class="action-btn" style="background:#95a5a6; color:white; flex:0.5;" onclick="resetGraph()">Reset</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-col">
            <div class="card solution-panel">
                <div class="tabs">
                    <div class="tab-item active" onclick="switchTab('a')">Part (a)</div>
                    <div class="tab-item" onclick="switchTab('b')">Part (b)</div>
                    <div class="tab-item" onclick="switchTab('model')">Full Answer</div>
                </div>

                <div id="tab-a" class="tab-content active">
                    <h4>1. Diagram Analysis (AO1/AO2)</h4>
                    <div class="explanation">
                        <ul>
                            <li><strong>Shift:</strong> Subsidy reduces costs $\rightarrow$ Supply shifts <strong>Right</strong> ($S \rightarrow S_1$).</li>
                            <li><strong>Equilibrium:</strong> Price falls ($P \rightarrow P_1$), Quantity rises ($Q \rightarrow Q_1$).</li>
                            <li><strong>Vertical Distance:</strong> Represents the subsidy per unit.</li>
                        </ul>
                    </div>
                    <h4>2. Evaluation: Impact of PED (AO3)</h4>
                    <div class="explanation">
                        <p>The cost to government = $Subsidy \times Quantity (Q_1)$.</p>
                        <p><span class="term">Inelastic Demand:</span> $Q$ rises slightly. Price drops significantly. <span class="highlight">Gov Spending is smaller.</span></p>
                        <p><span class="term">Elastic Demand:</span> $Q$ rises significantly. Price drops slightly. <span class="highlight">Gov Spending is larger.</span></p>
                    </div>
                </div>

                <div id="tab-b" class="tab-content">
                    <h4>1. Arguments FOR Tax</h4>
                    <div class="explanation">
                        <p>• Increases price and reduces quantity consumed.</p>
                        <p>• Internalizes the negative externality (makes polluter pay).</p>
                        <p>• Generates government revenue.</p>
                    </div>
                    <h4>2. Limitations (Why not "Always Best")</h4>
                    <div class="explanation">
                        <p>• <span class="term">Inelastic Demand:</span> For addictive goods (cigarettes), price rise causes little drop in $Q$. Tax is ineffective at reducing consumption.</p>
                        <p>• <span class="term">Black Markets:</span> High tax may lead to smuggling or illegal production.</p>
                        <p>• <span class="term">Regressive:</span> Burdens low-income groups more.</p>
                    </div>
                    <h4>3. Conclusion</h4>
                    <div class="explanation">
                        Tax is effective but not "always the best" on its own. A <span class="highlight">multi-policy approach</span> (e.g., Education + Regulation) is often better to address root causes.
                    </div>
                </div>

                <div id="tab-model" class="tab-content">
                    <div class="explanation" style="font-family: Georgia, serif; font-size:15px;">
                        
                        <!-- Part A 范文优化 -->
                        <div class="model-section">
                            <div class="model-header">Part (a) [8 Marks]</div>
                            <p>A <span class="highlight">subsidy</span> is a government payment to producers that lowers marginal costs. As shown in the diagram, this shifts the supply curve to the right (from $S$ to $S_1$).</p>
                            <span class="model-sub">Market Impact:</span>
                            <p>This creates excess supply at the original price, forcing the market price down to $P_1$ and quantity up to $Q_1$. Consumers benefit from lower prices.</p>
                            <span class="model-sub">Evaluation (Expenditure):</span>
                            <p>Government expenditure ($Subsidy \times Q_1$) depends on <span class="highlight">PED</span>. If demand is <span class="term">price elastic</span>, the % rise in quantity is large, causing high expenditure. If demand is <span class="term">inelastic</span>, quantity rises little, limiting the cost.</p>
                        </div>

                        <!-- Part B 范文优化 -->
                        <div class="model-section" style="border-bottom:none;">
                            <div class="model-header">Part (b) [12 Marks]</div>
                            <p>A tax on demerit goods (e.g., tobacco) aims to raise prices and reduce consumption to fix market failure.</p>
                            <span class="model-sub">Arguments For:</span>
                            <p>Indirect taxes shift supply left, raising price. According to the law of demand, this reduces consumption and internalizes negative externalities.</p>
                            <span class="model-sub">Limitations (Why not always best):</span>
                            <p>However, demand for demerit goods is often <span class="highlight">price inelastic</span> due to addiction. A tax raises price but reduces quantity very little, failing its objective. High taxes may also encourage <span class="highlight">black markets</span>.</p>
                            <span class="model-sub">Conclusion:</span>
                            <p>Therefore, tax is <span class="highlight">not always the best way</span> on its own. It is most effective when combined with <span class="highlight">education</span> (to reduce demand) and <span class="highlight">regulation</span>.</p>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, subsidy=0, isElastic=false, isExamMode=false;

        function resize() {
            if(!canvas.parentElement) return;
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = 450; 
            width = canvas.width; height = canvas.height;
            draw();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        // 手动拖动滑块
        function manualMode() { 
            isExamMode = false; 
            subsidy = parseInt(document.getElementById('sliderSubsidy').value); 
            draw(); 
        }

        // 考试模式：强制设置参数，并刷新画布
        function showExamMode() { 
            isExamMode = true; 
            subsidy = 40; // 给一个明显的偏移量
            document.getElementById('sliderSubsidy').value = 40; // 同步滑块视觉
            
            // 强制设为无弹性 (标准图一般画无弹性较清晰)，并高亮按钮
            isElastic = false;
            updatePedButtons();
            
            draw(); 
        }

        function setPED(val) { 
            isElastic = (val > 1); 
            updatePedButtons();
            draw(); 
        }

        function updatePedButtons() {
            document.getElementById('btnInelastic').className = !isElastic ? 'action-btn active' : 'action-btn'; 
            document.getElementById('btnElastic').className = isElastic ? 'action-btn active' : 'action-btn'; 
        }

        function resetGraph() { 
            isExamMode = false; 
            subsidy = 0; 
            document.getElementById('sliderSubsidy').value = 0; 
            draw(); 
        }
        
        function switchTab(id) {
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            const index = id==='a'?0:(id==='b'?1:2);
            document.querySelectorAll('.tab-item')[index].classList.add('active');
            document.getElementById('tab-'+id).classList.add('active');
        }

        function draw() {
            if(!width) return;
            ctx.clearRect(0,0,width,height);
            const p=40, W=width-2*p, H=height-2*p, O={x:p, y:height-p};
            
            // Axes
            ctx.beginPath(); ctx.strokeStyle='#333'; ctx.lineWidth=2;
            ctx.moveTo(p,p); ctx.lineTo(p,height-p); ctx.lineTo(width-p,height-p); ctx.stroke();
            ctx.fillStyle='#333'; ctx.font='bold 14px Arial';
            ctx.fillText("Price",10,20); ctx.fillText("Quantity",width-60,height-10);

            // Curves Config
            let dStart, dEnd;
            if(isElastic) { dStart={x:p, y:O.y-H*0.6}; dEnd={x:width-p, y:O.y-H*0.4}; } 
            else { dStart={x:p+W*0.1, y:p}; dEnd={x:p+W*0.7, y:height-p}; }
            
            let sStart={x:p+W*0.1, y:height-p-H*0.2}; let sEnd={x:p+W*0.8, y:p+H*0.1};

            // Draw Base Curves
            drawLine(dStart, dEnd, '#2980b9', 'D');
            drawLine(sStart, sEnd, '#c0392b', 'S');

            // Shift Logic
            // Subsidy shifts Supply Right (looks like Down on Price axis)
            // shiftPx represents the vertical drop in price for same Q
            let shiftPx = subsidy/100 * (H*0.25);
            
            // Intersection 1 (Original)
            let eq1 = getIntersection(dStart,dEnd,sStart,sEnd);

            if(subsidy > 0) {
                // Shifted Supply Coordinates (Parallel shift)
                // Supply: y = mx + c. New Supply: y = mx + (c + shift)  [Canvas Y increases down]
                let s2Start={x:sStart.x, y:sStart.y+shiftPx}; 
                let s2End={x:sEnd.x, y:sEnd.y+shiftPx};

                drawLine(s2Start, s2End, '#e67e22', isExamMode?'S1':'S+Sub');
                
                let eq2 = getIntersection(dStart,dEnd,s2Start,s2End);
                
                drawPoint(eq1); drawPoint(eq2);
                drawDotted(eq1, isExamMode?'P':'P0', isExamMode?'Q':'Q0');
                drawDotted(eq2, 'P1', 'Q1');
                
                // Gov Box
                // Top of box is on OLD supply curve directly above Q1
                // We need Y on line S at x = eq2.x
                let mS = (sEnd.y - sStart.y) / (sEnd.x - sStart.x);
                let cS = sStart.y - mS * sStart.x;
                let topY = mS * eq2.x + cS;
                
                // 无论是否 ExamMode，只要有 subsidy 就画阴影
                ctx.fillStyle='rgba(241,196,15,0.3)';
                ctx.fillRect(O.x, topY, eq2.x-O.x, eq2.y-topY);
                
                if(subsidy>10 || isExamMode) { 
                    ctx.fillStyle='#d35400'; ctx.font='bold 12px Arial';
                    ctx.fillText("Gov Spend", O.x+10, (topY+eq2.y)/2); 
                }

                if(isExamMode) {
                    // Draw Arrow indicating Shift
                    drawArrow((sStart.x+sEnd.x)/2, (sStart.y+sEnd.y)/2, (s2Start.x+s2End.x)/2, (s2Start.y+s2End.y)/2);
                }
            } else {
                drawPoint(eq1); drawDotted(eq1, 'P', 'Q');
            }
        }

        function drawLine(p1,p2,c,l) { ctx.beginPath(); ctx.strokeStyle=c; ctx.lineWidth=3; ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke(); ctx.fillStyle=c; ctx.fillText(l,p2.x-20,p2.y-10); }
        function drawPoint(p) { ctx.beginPath(); ctx.fillStyle='#333'; ctx.arc(p.x,p.y,5,0,Math.PI*2); ctx.fill(); }
        function drawDotted(p,yl,xl) { ctx.beginPath(); ctx.setLineDash([5,5]); ctx.strokeStyle='#7f8c8d'; ctx.lineWidth=1; ctx.moveTo(p.x,p.y); ctx.lineTo(40,p.y); ctx.moveTo(p.x,p.y); ctx.lineTo(p.x,450-40); ctx.stroke(); ctx.setLineDash([]); ctx.fillStyle='#333'; ctx.fillText(yl,20,p.y+5); ctx.fillText(xl,p.x-5,450-20); }
        function drawArrow(x1,y1,x2,y2) { let a=Math.atan2(y2-y1,x2-x1); ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.stroke(); ctx.beginPath(); ctx.moveTo(x2,y2); ctx.lineTo(x2-10*Math.cos(a-Math.PI/6), y2-10*Math.sin(a-Math.PI/6)); ctx.lineTo(x2-10*Math.cos(a+Math.PI/6), y2-10*Math.sin(a+Math.PI/6)); ctx.fillStyle='#000'; ctx.fill(); }
        function getIntersection(p1,p2,p3,p4) { let m1=(p2.y-p1.y)/(p2.x-p1.x), c1=p1.y-m1*p1.x, m2=(p4.y-p3.y)/(p4.x-p3.x), c2=p3.y-m2*p3.x; let x=(c2-c1)/(m1-m2), y=m1*x+c1; return {x,y}; }

        setTimeout(()=>{ resize(); resetGraph(); }, 200);
    </script>
</body>
</html>