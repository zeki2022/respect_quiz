<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q2: Hammer & Nail</title>
    
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        .container { width: 96%; max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 420px; gap: 20px; align-items: start; }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }
        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .back-arrow { position: fixed; top: 15px; left: 15px; z-index: 9999; width: 40px; height: 40px; background: rgba(255,255,255,0.9); border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; text-decoration: none; color: #333; font-size: 24px; font-weight: bold; font-family: sans-serif; line-height: 1; cursor: pointer; }
        
        /* 画布防塌陷 */
        .canvas-container { 
            width: 100%; height: 0; 
            padding-bottom: 50%; 
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
            min-height: 400px; /* 强制高度 */
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size:14px;}
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        
        .step-box { border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fff; border-radius: 8px; border-left: 4px solid #ccc; transition: all 0.3s; opacity: 0.8; }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); opacity: 1; transform: translateX(-5px); }
        .step-title { font-weight: bold; color: #2c3e50; margin-bottom: 5px; display: block; font-size: 15px; border-bottom: 1px dashed #ddd; padding-bottom:5px;}
        
        /* 修复：公式容器样式 */
        .math-eq { 
            font-family: 'Times New Roman', serif; font-size: 1.1em; 
            color: #2c3e50; background: #f9f9f9; border: 1px solid #eee; 
            padding: 4px 8px; border-radius: 4px; margin: 5px 0; display: block; 
        }
        .highlight { color: #d35400; font-weight: bold; }
        .explanation { font-size: 13px; color: #666; margin-bottom: 8px; line-height: 1.4; }
        
        .orig-img { max-width: 100%; display: block; margin: 10px 0; border-radius: 4px; border:1px solid #eee; }
        .problem-text { font-size: 15px; line-height: 1.6; color: #333; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：动画演示 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q2</h3>
                
                <!-- 全文还原 (Full Text) -->
                <div class="problem-text">
                    <img src="q2_orig.png" class="orig-img" onerror="this.style.display='none'">
                    
                    <p>A machine for driving a nail into a block of wood causes a hammerhead to drop vertically onto the top of the nail. The mass of the hammerhead is $1.5$ kg and the mass of the nail is $0.005$ kg (see diagram). The hammerhead hits the nail with speed $32 \text{ ms}^{-1}$ and remains in contact with the nail after the impact.</p>
                    
                    <strong>(a)</strong> Calculate the speed with which the combined hammerhead and nail move immediately after the impact. Give your answer correct to 3 decimal places. [2]<br><br>
                    
                    <p>There is a constant force resisting the motion of magnitude $25000$ N.</p>
                    <strong>(b)</strong> Calculate the distance the nail is driven into the wood. [3]
                </div>

                <div style="margin-top:20px; border-top:2px solid #eee; padding-top:20px;">
                    <h4 style="margin:0 0 10px 0; color:#3498db;">Simulation</h4>
                    <div class="canvas-container">
                        <canvas id="simCanvas"></canvas>
                        <div style="position:absolute; top:10px; left:10px; font-size:13px; color:#555; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px;">
                            Status: <span id="statusText" style="font-weight:bold;">Ready</span><br>
                            Velocity: <span id="velText" style="font-weight:bold; color:#2c3e50;">0.00</span> m/s
                        </div>
                    </div>

                    <div class="controls">
                        <button class="action-btn" onclick="startSim()" id="btnStart">Drop Hammer</button>
                        <button class="action-btn" style="background:#95a5a6" onclick="resetSim()">Reset</button>
                        
                        <div style="flex:1; display:flex; align-items:center; justify-content:flex-end; gap:10px;">
                            <span style="font-weight:bold; color:#555; font-size:12px;">Speed:</span>
                            <input type="range" id="speedRange" min="0.1" max="2.0" step="0.1" value="0.5" style="width:100px; cursor:pointer;">
                            <span id="speedVal" style="width:30px; text-align:right; font-size:12px;">0.5x</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧：解题步骤 (修复 MathJax) -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <div class="step-box" style="background:#fff8e1; border-left-color:#f1c40f; opacity:1;">
                    <span class="step-title">Given Data</span>
                    $m_{\text{hammer}} = 1.5$ kg, $m_{\text{nail}} = 0.005$ kg<br>
                    $u = 32 \text{ ms}^{-1}$ (Impact Speed)<br>
                    $F_{\text{resist}} = 25000$ N
                </div>

                <!-- Part A -->
                <div id="step1" class="step-box">
                    <span class="step-title">Part (a): Conservation of Momentum</span>
                    <div class="explanation">
                        The hammer and nail coalesce (stick together). Total momentum is conserved during impact.
                    </div>
                    $$m_h u + m_n(0) = (m_h + m_n) v$$
                    Substitute values:
                    $$1.5(32) = (1.5 + 0.005) v$$
                    $$48 = 1.505 v$$
                    $$v = \frac{48}{1.505} \approx 31.8936...$$
                    <span class="math-eq highlight">$v = 31.894 \text{ ms}^{-1}$ (3 d.p.)</span> <strong>(A1)</strong>
                </div>

                <!-- Part B -->
                <div id="step2" class="step-box" style="border-left-color: #e67e22;">
                    <span class="step-title" style="color:#e67e22;">Part (b): Work-Energy Method</span>
                    <div class="explanation">
                        The combined kinetic energy and potential energy lost are used to overcome the resistance force ($R$) over distance $s$.
                    </div>
                    <strong>Energy Balance Equation:</strong>
                    $$\Delta KE + \Delta PE = \text{Work Done}$$
                    $$\frac{1}{2}Mv^2 + Mgs = R \times s$$
                    Where $M = 1.505$, $v = 31.894$, $R = 25000$.<br><br>
                    
                    Substitute:
                    $$0.5(1.505)(31.894)^2 + 1.505(10)s = 25000s$$
                    $$765.45 + 15.05s = 25000s$$
                    $$24984.95s = 765.45$$
                    $$s = \frac{765.45}{24984.95} \approx 0.03063...$$
                    <span class="math-eq highlight">$s = 0.031 \text{ m}$</span> <strong>(A1)</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Visual Parameters
        let hammerY = 0;
        let nailY = 0;
        let woodY = 0;
        let cx = 0;
        
        // Physics State
        let simState = 'RESET'; // RESET, DROP, DRIVE, END
        let animId;
        let currentVel = 0;
        let timeScale = 0.5;
        
        const dropHeight = 200;
        const impactSpeed = 32;
        const postImpactSpeed = 31.894;
        const driveDist = 30; 
        
        // Controls
        document.getElementById('speedRange').addEventListener('input', function(e) {
            timeScale = parseFloat(e.target.value);
            document.getElementById('speedVal').innerText = timeScale.toFixed(1) + "x";
        });

        // 【修复】双重初始化，防止高度为0
        function resize() {
            if(!canvas.parentElement) return;
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight || 400; // 兜底 400
            initScene();
            if(simState === 'RESET' || simState === 'END') drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function initScene() {
            const w = canvas.width;
            const h = canvas.height;
            cx = w / 2;
            woodY = h * 0.65; 
            nailY = woodY - 40; 
            hammerY = nailY - dropHeight; 
        }

        function startSim() {
            if(simState !== 'RESET') return;
            simState = 'DROP';
            document.getElementById('btnStart').disabled = true;
            document.getElementById('statusText').innerText = "Dropping...";
            currentVel = 0; 
            
            let lastTime = performance.now();
            function loop(now) {
                let dt = (now - lastTime) / 1000; lastTime = now; if(dt > 0.1) dt = 0.1;
                dt *= timeScale;
                update(dt);
                drawFrame();
                if (simState !== 'END') animId = requestAnimationFrame(loop);
            }
            animId = requestAnimationFrame(loop);
        }

        function resetSim() {
            cancelAnimationFrame(animId);
            simState = 'RESET';
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnStart').innerText = "Drop Hammer";
            document.getElementById('statusText').innerText = "Ready";
            document.getElementById('velText').innerText = "0.00";
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            initScene();
            drawFrame();
        }

        function update(dt) {
            if (simState === 'DROP') {
                currentVel += 9.8 * dt * 10; 
                hammerY += currentVel * dt * 20; 
                
                if (hammerY >= nailY) {
                    hammerY = nailY;
                    simState = 'DRIVE';
                    currentVel = postImpactSpeed; 
                    highlightStep(1);
                }
            } 
            else if (simState === 'DRIVE') {
                document.getElementById('statusText').innerText = "Impact! Driving...";
                
                let move = currentVel * dt * 20; // Visual scale
                hammerY += move;
                nailY += move;
                
                // Decelerate
                currentVel -= 200 * dt; 
                
                if (currentVel <= 0) {
                    simState = 'END';
                    currentVel = 0;
                    document.getElementById('btnStart').innerText = "Finished";
                    document.getElementById('statusText').innerText = "Stopped";
                    highlightStep(2);
                }
            }
            document.getElementById('velText').innerText = currentVel.toFixed(2);
        }
        
        function highlightStep(id) {
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            let step = document.getElementById('step'+id);
            if(step) step.classList.add('active');
        }

        function drawFrame() {
            const w = canvas.width; const h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            if (!woodY) initScene();

            // Wood
            ctx.fillStyle = '#d35400'; 
            ctx.fillRect(cx - 70, woodY, 140, h - woodY);
            ctx.strokeStyle = '#a04000'; ctx.lineWidth=2;
            ctx.strokeRect(cx - 70, woodY, 140, h - woodY);
            ctx.fillStyle = 'white'; ctx.font='bold 12px Arial'; ctx.textAlign='center';
            ctx.fillText("Wood Block", cx, woodY + 20);

            // Nail
            ctx.fillStyle = '#95a5a6'; ctx.fillRect(cx - 3, nailY, 6, 50);
            ctx.fillStyle = '#7f8c8d'; ctx.fillRect(cx - 8, nailY, 16, 4);
            
            // Hammer
            ctx.fillStyle = '#34495e'; ctx.fillRect(cx - 30, hammerY - 40, 60, 40);
            ctx.fillStyle = '#e67e22'; ctx.fillRect(cx - 5, hammerY - 100, 10, 60);
            
            // Impact
            if (simState === 'DRIVE') {
                ctx.strokeStyle = '#f1c40f'; ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx - 35, hammerY); ctx.lineTo(cx - 50, hammerY - 15);
                ctx.moveTo(cx + 35, hammerY); ctx.lineTo(cx + 50, hammerY - 15);
                ctx.stroke();
            }
        }

        // 终极防白屏
        resize(); 
        setTimeout(resize, 500);
    </script>
</body>
</html>