<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q7: Connected Particles</title>
    
    <!-- 1. 引用公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- 2. MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* 3. 核心布局与样式 */
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 420px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        .canvas-container { width: 100%; height: 0; padding-bottom: 40%; position: relative; background: #fff; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; overflow:hidden; }
        @media (max-width: 1000px) { .canvas-container { padding-bottom: 60%; } }
        
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;}
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        
        .step-box { border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fff; border-radius: 8px; border-left: 4px solid #ccc; transition: all 0.3s; }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .step-title { font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block; font-size: 15px; border-bottom: 1px dashed #ddd; padding-bottom:5px;}
        .math-eq { font-family: 'Times New Roman', serif; font-size: 1.1em; color: #2c3e50; background: #f9f9f9; border: 1px solid #eee; padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block; }
        .highlight { color: #d35400; font-weight: bold; background: #fff5e0; padding: 0 4px; border-radius: 2px; }
        
        .energy-bar-container { height: 24px; background: #eee; border-radius: 6px; overflow: hidden; display: flex; margin-top: 10px; border:1px solid #ccc;}
        .bar-pe { background: #e74c3c; width: 0%; transition: width 0.1s; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; overflow: hidden; white-space: nowrap;}
        .bar-ke { background: #2ecc71; width: 0%; transition: width 0.1s; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; overflow: hidden; white-space: nowrap;}
        .bar-work { background: #95a5a6; width: 0%; transition: width 0.1s; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; overflow: hidden; white-space: nowrap;}
        .legend { font-size: 12px; color: #666; margin-top:5px; display:flex; gap:15px; justify-content:center;}
        .dot { width:8px; height:8px; display:inline-block; border-radius:50%; margin-right:4px;}
        
        .problem-text { background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333; }
        .orig-img { max-width: 100%; mix-blend-mode:multiply; margin-bottom:10px; border-radius:4px; }
    </style>
</head>
<body>

    <!-- 原生导航 -->
    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：动画演示 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q7</h3>
                
                <div class="problem-text">
                    <img src="q7_orig.png" class="orig-img" onerror="this.style.display='none'">
                    
                    <p>Two particles $A$ and $B$ of masses $6.5$ kg and $m$ kg respectively are connected by a light inextensible string that passes over a smooth pulley. The pulley is fixed at the top of a rough slope which is at an angle of $\alpha$ to the horizontal ground, where $\tan \alpha = \frac{5}{12}$. $A$ is on the rough slope and $B$ hangs below the pulley (see diagram). The coefficient of friction between the slope and $A$ is $0.4$.</p>
                    <p><strong>(a)</strong> Given that the system is in equilibrium, find the set of possible values of $m$. [7]</p>
                    <p><strong>(b)</strong> It is given instead that $m = 12$ and the particles are released from rest with the string taut. Use an energy method to find the speed of the particles when each particle has moved $0.6$ m. [5]</p>
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:10px; left:10px; font-size:14px; color:#333; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px;">
                        Distance: <span id="distVal" style="font-weight:bold; color:#3498db;">0.0</span> m
                    </div>
                </div>

                <div class="energy-bar-container">
                    <div class="bar-pe" id="barPE">PE</div>
                    <div class="bar-ke" id="barKE">KE</div>
                    <div class="bar-work" id="barWork">Friction</div>
                </div>
                <div class="legend">
                    <span><span class="dot" style="background:#e74c3c"></span>Net PE Loss</span>
                    <span><span class="dot" style="background:#2ecc71"></span>KE Gain</span>
                    <span><span class="dot" style="background:#95a5a6"></span>Work vs Friction</span>
                </div>

                <div class="controls" style="margin-top:15px;">
                    <button class="action-btn" onclick="startSim()" id="btnStart">Start Animation (Part b)</button>
                    <button class="action-btn" style="background:#95a5a6" onclick="resetSim()">Reset</button>
                    
                    <div style="flex:1; display:flex; align-items:center; justify-content:flex-end; gap:10px;">
                        <span style="font-weight:bold; color:#555; font-size:12px;">Speed:</span>
                        <input type="range" id="speedRange" min="0.1" max="2.0" step="0.1" value="1.0" style="width:100px; cursor:pointer;">
                        <span id="speedVal" style="width:30px; text-align:right; font-size:12px;">1.0x</span>
                    </div>
                    <div style="width:100%; text-align:right; margin-top:5px; font-weight:bold; color:#2c3e50; font-size:18px;">
                        v = <span id="velDisplay">0.00</span> m/s
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧：深度解析 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <!-- Part (a) 逻辑 -->
                <div class="step-box" style="border-left-color: #27ae60;">
                    <span class="step-title">Part (a): Equilibrium Analysis (7 marks)</span>
                    <div><strong>1. Resolve forces on A:</strong></div>
                    From $\tan\alpha = \frac{5}{12}$, we have $\sin\alpha = \frac{5}{13}, \cos\alpha = \frac{12}{13}$.<br>
                    Normal Reaction $R = 6.5g \cos\alpha = 60$ N <strong>(B1)</strong><br>
                    Friction Limit $F_{max} = \mu R = 0.4 \times 60 = 24$ N<br>
                    Weight down slope $P = 6.5g \sin\alpha = 25$ N<br><br>
                    
                    <strong>2. Analyze Limiting Equilibrium:</strong><br>
                    Tension $T = mg$. Equilibrium occurs when $T$ balances $P$ and Friction.<br><br>
                    
                    <strong>Case 1: A about to slip DOWN</strong> (Friction acts UP)<br>
                    $T + F_{max} = P \Rightarrow T = 25 - 24 = 1$ N<br>
                    $mg = 1 \Rightarrow m = 0.1$ kg<br><br>
                    
                    <strong>Case 2: A about to slip UP</strong> (Friction acts DOWN)<br>
                    $T = P + F_{max} \Rightarrow T = 25 + 24 = 49$ N<br>
                    $mg = 49 \Rightarrow m = 4.9$ kg<br><br>
                    
                    <span class="math-eq highlight">$0.1 \le m \le 4.9$</span> <strong>(A1)</strong>
                </div>

                <!-- Part (b) 逻辑 -->
                <div id="step-b1" class="step-box">
                    <span class="step-title">Part (b): Energy Method (5 marks)</span>
                    <div><strong>1. Calculate Energy Changes</strong></div>
                    System moves $s = 0.6$ m. Mass $B$ falls ($m=12$), Mass $A$ rises.<br>
                    PE Loss (B): $12g \times 0.6 = 72$ J<br>
                    PE Gain (A): $6.5g \times 0.6 \sin\alpha = 15$ J<br>
                    <span class="math-eq highlight">Net PE Loss = 72 - 15 = 57 J</span> <strong>(B1)</strong>
                </div>

                <div id="step-b2" class="step-box">
                    <span class="step-title">2. Work Done against Friction</span>
                    $WD = \text{Friction} \times \text{Distance}$<br>
                    $WD = 24 \times 0.6 = \mathbf{14.4}$ J <strong>(B1)</strong>
                </div>

                <div id="step-b3" class="step-box">
                    <span class="step-title">3. Conservation of Energy Principle</span>
                    <div>Net PE Loss = KE Gain + Work Done</div>
                    $57 = \frac{1}{2}(m_A + m_B)v^2 + 14.4$<br>
                    $57 = \frac{1}{2}(6.5 + 12)v^2 + 14.4$ <strong>(M1)</strong><br>
                    $42.6 = 9.25 v^2$<br>
                    $v = \sqrt{\frac{42.6}{9.25}} \approx \mathbf{2.15}$ m/s <strong>(A1)</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Physics
        const g = 10;
        const sinA = 5/13;
        const cosA = 12/13;
        const mA = 6.5;
        const mB = 12; 
        const mu = 0.4;
        const distTotal = 0.6; 
        
        // Force Calculation
        const weightA_parallel = mA * g * sinA; // 25
        const friction = mu * mA * g * cosA; // 24
        const weightB = mB * g; // 120
        const netForce = weightB - weightA_parallel - friction; // 71
        const totalMass = mA + mB; // 18.5
        const acceleration = netForce / totalMass; 
        const finalVel = Math.sqrt(2 * acceleration * distTotal); 
        
        let simState = 'RESET';
        let animId;
        let currentDist = 0;
        let currentVel = 0;
        let timeScale = 1.0; 
        let path = {};

        document.getElementById('speedRange').addEventListener('input', function(e) {
            timeScale = parseFloat(e.target.value);
            document.getElementById('speedVal').innerText = timeScale.toFixed(1) + "x";
        });

        function resize() {
            if(!canvas.parentElement) return;
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight || 400;
            initPath();
            if(simState !== 'RUNNING') drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function initPath() {
            const w = canvas.width;
            const h = canvas.height;
            
            const pulley = { x: w * 0.3, y: h * 0.15 };
            const slopeRun = w * 0.6; 
            const slopeRise = slopeRun * (5/12);
            const slopeEnd = { x: pulley.x + slopeRun, y: pulley.y + slopeRise };
            
            const slopePixelLen = Math.sqrt(slopeRun**2 + slopeRise**2);
            const visualScale = slopePixelLen / 2.5; 
            
            path = { pulley, slopeEnd, visualScale };
        }

        function startSim() {
            if(simState === 'RUNNING') return;
            simState = 'RUNNING';
            document.getElementById('btnStart').disabled = true;
            let lastTime = performance.now();
            function loop(now) {
                if(simState !== 'RUNNING') return;
                let dt = (now - lastTime) / 1000; lastTime = now; if(dt > 0.1) dt = 0.1;
                update(dt * timeScale);
                drawFrame();
                animId = requestAnimationFrame(loop);
            }
            animId = requestAnimationFrame(loop);
        }

        function resetSim() {
            cancelAnimationFrame(animId);
            simState = 'RESET';
            currentDist = 0;
            currentVel = 0;
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnStart').innerText = "Start Animation (Part b)";
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            updateBars();
            drawFrame();
        }

        function update(dt) {
            if (currentDist < distTotal) {
                currentVel += acceleration * dt;
                currentDist += currentVel * dt;
                
                let p = currentDist / distTotal;
                if (p < 0.3) highlightStep('b1');
                else if (p < 0.6) highlightStep('b2');
                else highlightStep('b3');
            } else {
                currentDist = distTotal;
                currentVel = finalVel;
                simState = 'END';
                document.getElementById('btnStart').innerText = "Finished";
            }
            document.getElementById('velDisplay').innerText = currentVel.toFixed(2);
            updateBars();
        }
        
        function highlightStep(id) {
            document.querySelectorAll('.step-box').forEach(el => {
                if(el.id && el.id.startsWith('step-')) el.classList.remove('active');
            });
            let step = document.getElementById('step-'+id);
            if(step) step.classList.add('active');
        }

        function updateBars() {
            let netPELoss = (mB * g * currentDist) - (mA * g * currentDist * sinA);
            let workDone = friction * currentDist;
            let ke = 0.5 * totalMass * currentVel * currentVel;
            let totalRef = 60; 
            
            document.getElementById('barPE').style.width = Math.min((netPELoss / totalRef * 100), 100) + '%';
            document.getElementById('barWork').style.width = Math.min((workDone / totalRef * 100), 100) + '%';
            document.getElementById('barKE').style.width = Math.min((ke / totalRef * 100), 100) + '%';
        }

        function drawFrame() {
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            
            const px = path.pulley.x;
            const py = path.pulley.y;
            const ex = path.slopeEnd.x;
            const ey = path.slopeEnd.y;
            const scale = path.visualScale;
            
            ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(ex, ey); ctx.lineTo(px, ey); ctx.closePath();
            ctx.fillStyle = '#ecf0f1'; ctx.fill();
            ctx.strokeStyle = '#7f8c8d'; ctx.lineWidth = 3; ctx.stroke();
            
            ctx.beginPath(); ctx.arc(px, py, 12, 0, Math.PI*2);
            ctx.fillStyle = '#bdc3c7'; ctx.fill(); ctx.stroke();
            
            const movePx = currentDist * scale;
            const startDistA = 1.5 * scale; 
            const currDistA = startDistA - movePx;
            const dx = ex - px, dy = ey - py, len = Math.sqrt(dx*dx + dy*dy);
            const ux = dx/len, uy = dy/len;
            const ax = px + ux * currDistA, ay = py + uy * currDistA;
            
            const bx = px - 15; const startDistB = 0.2 * scale;
            const by = py + startDistB + movePx;
            
            ctx.strokeStyle = '#333'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(ax, ay); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(bx, by); ctx.stroke();
            
            ctx.save(); ctx.translate(ax, ay); ctx.rotate(Math.atan2(dy, dx));
            ctx.fillStyle = '#e67e22'; ctx.fillRect(-20, -30, 40, 30);
            ctx.fillStyle = 'white'; ctx.font = 'bold 12px Arial'; ctx.fillText("A", -5, -10);
            ctx.restore(); ctx.fillStyle='#333'; ctx.fillText("6.5kg", ax+20, ay);
            
            ctx.save(); ctx.translate(bx, by);
            ctx.fillStyle = '#3498db'; ctx.fillRect(-15, 0, 30, 30);
            ctx.fillStyle = 'white'; ctx.font = 'bold 12px Arial'; ctx.fillText("B", -5, 20);
            ctx.restore(); ctx.fillStyle='#333'; ctx.fillText("m kg", bx+20, by+15);
            
            ctx.fillStyle = '#7f8c8d'; ctx.fillText("α", px+50, py+20);
        }

        setTimeout(() => { resize(); updateBars(); }, 500);
    </script>
</body>
</html>