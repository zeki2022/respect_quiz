<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q5: Power & Resistance</title>
    
    <!-- 1. 引用公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- 2. MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* 3. 布局遵循标准模板 */
        body { 
            padding-top: 60px; padding-bottom: 40px; 
            background-color: #f4f7f6; 
            max-width: none !important; 
        }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 500px; /* 右侧留宽一点给详细文字 */
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        .orig-img { 
            max-width: 100%; height: auto; 
            border: 1px solid #eee; border-radius: 6px; 
            margin-bottom: 15px; mix-blend-mode: multiply; 
            display: block;
        }

        /* 画布高度控制：扁平化 */
        .canvas-container { 
            width: 100%; height: 300px; /* 固定高度 */
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 10px; overflow:hidden; 
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* 仪表盘 */
        .dashboard {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            margin-bottom: 15px; background: #2c3e50; padding: 10px; border-radius: 8px; color: white;
        }
        .dash-item { text-align: center; }
        .dash-label { font-size: 12px; opacity: 0.8; display: block; }
        .dash-val { font-family: monospace; font-size: 16px; font-weight: bold; color: #3498db; }

        /* 控制条 */
        .controls { 
            display: flex; flex-direction: column; gap: 10px; 
            background: #f8f9fa; padding: 15px; border-radius: 8px; border:1px solid #eee;
        }
        .mode-btns { display: flex; gap: 10px; width: 100%; }
        
        button.action-btn { 
            flex: 1; background-color: #fff; color: #333; border: 1px solid #ccc; 
            padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size:14px;
            transition: all 0.2s;
        }
        button.action-btn.active { background-color: #2c3e50; color: white; border-color: #2c3e50; }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        
        /* 步骤框 - 增强可读性 */
        .step-box { 
            border: 1px solid #eee; padding: 15px; margin-bottom: 15px; 
            background: #fff; border-radius: 8px; border-left: 4px solid #ccc; 
            transition: all 0.3s; 
        }
        .active-step { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .step-title { font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block; font-size: 15px; border-bottom: 1px dashed #ddd; padding-bottom:5px;}
        .math-eq { font-family: 'Times New Roman', serif; font-size: 1.1em; color: #2c3e50; background: #f9f9f9; border: 1px solid #eee; padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block; }
        .highlight { color: #d35400; font-weight: bold; background: #fff5e0; padding: 0 4px; border-radius: 2px; }
        .explanation { font-size: 13px; color: #555; margin-bottom: 8px; line-height: 1.5; border-left: 2px solid #eee; padding-left: 8px; }
        
        .problem-text { background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：动画 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q5</h3>
                
                <div class="problem-text">
                    <img src="q5_orig.png" class="orig-img" onerror="this.style.display='none'" alt="Diagram">
                    <p>A car of mass $1500$ kg is travelling along a straight horizontal road.</p>
                    <p><strong>(a)</strong> It is given that there is a constant resistance to motion. The engine of the car is working at $24$ kW while the car is travelling at a constant speed of $32$ m s$^{-1}$. The power is now increased to $28$ kW. Find the acceleration of the car at the instant it is travelling at a speed of $36$ m s$^{-1}$. [4]</p>
                    <p><strong>(b)</strong> It is given instead that the resistance to the motion of the car is $(340 + 4v)$ N when the speed of the car is $v$ m s$^{-1}$. When the engine is working at $20$ kW, the car is travelling at constant speed. Find this constant speed. [3]</p>
                </div>

                <div class="dashboard">
                    <div class="dash-item"><span class="dash-label">Power (P)</span><span class="dash-val" id="dispP">0</span> kW</div>
                    <div class="dash-item"><span class="dash-label">Speed (v)</span><span class="dash-val" id="dispV">0</span> m/s</div>
                    <div class="dash-item"><span class="dash-label">Drive (F)</span><span class="dash-val" id="dispF">0</span> N</div>
                    <div class="dash-item"><span class="dash-label">Resist (R)</span><span class="dash-val" id="dispR">0</span> N</div>
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                </div>

                <div class="controls">
                    <div class="mode-btns">
                        <button class="action-btn active" onclick="setMode('a')" id="btnModeA">Part (a)</button>
                        <button class="action-btn" onclick="setMode('b')" id="btnModeB">Part (b)</button>
                    </div>
                    <div style="display:flex; gap:10px; align-items:center;">
                         <span style="font-size:12px; font-weight:bold; color:#555;">Speed:</span>
                         <input type="range" id="speedRange" min="0.1" max="2.0" step="0.1" value="0.5" style="flex:1; cursor:pointer;">
                         <button class="action-btn" style="flex:0 0 80px; background:#95a5a6; color:white;" onclick="resetSim()">Reset</button>
                         <button class="action-btn" style="flex:0 0 80px; background:#3498db; color:white;" onclick="startSim()" id="btnStart">Start</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧：解析 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <div class="step-box" style="background:#fff8e1; border-left-color:#f1c40f;">
                    <span class="step-title">Fundamental Principles</span>
                    <div class="explanation">
                        1. Power $P = \text{Force} \times \text{Velocity}$, so Driving Force $F = \frac{P}{v}$.<br>
                        2. Newton's Second Law: $F_{net} = ma \Rightarrow F - R = ma$.
                    </div>
                </div>

                <!-- Part (a) -->
                <div id="content-a">
                    <div class="step-box active-step">
                        <span class="step-title">Step 1: Find Constant Resistance ($R$)</span>
                        <div class="explanation">
                            Initially, the car travels at a <strong>constant speed</strong> of $32$ m/s with Power $24$ kW ($24000$ W).<br>
                            Constant speed means acceleration $a=0$, so Driving Force equals Resistance.
                        </div>
                        $P = 24000$ W, $v = 32$ m s$^{-1}$<br>
                        $F = \frac{P}{v} = \frac{24000}{32} = 750$ N<br>
                        Since $a=0$, $R = F = 750$ N <strong>(B1)</strong>
                    </div>

                    <div class="step-box">
                        <span class="step-title">Step 2: New State ($P=28$kW, $v=36$)</span>
                        <div class="explanation">
                            The power increases to $28$ kW ($28000$ W). We need to find acceleration at the instant $v=36$.<br>
                            Calculate the <strong>new Driving Force</strong>:
                        </div>
                        $F_{new} = \frac{28000}{36} \approx 777.78$ N <strong>(M1)</strong>
                    </div>

                    <div class="step-box">
                        <span class="step-title">Step 3: Newton's Second Law</span>
                        <div class="explanation">
                            Apply $F_{net} = ma$. Resistance $R$ is constant ($750$ N). Mass $m = 1500$ kg.
                        </div>
                        $F_{new} - R = ma$<br>
                        $\frac{28000}{36} - 750 = 1500a$ <strong>(DM1)</strong><br>
                        $777.78 - 750 = 1500a$<br>
                        $27.78 = 1500a$<br>
                        $a = \frac{27.78}{1500}$<br>
                        <span class="math-eq highlight">$a \approx 0.0185$ m s$^{-2}$</span> (or $\frac{1}{54}$) <strong>(A1)</strong>
                    </div>
                </div>

                <!-- Part (b) -->
                <div id="content-b" style="display:none;">
                    <div class="step-box active-step" style="border-left-color:#8e44ad;">
                        <span class="step-title" style="color:#8e44ad;">Part (b): Variable Resistance</span>
                        <div class="explanation">
                            New scenario: $R = 340 + 4v$. Power $P = 20$ kW ($20000$ W).<br>
                            <strong>"Constant speed"</strong> means $a=0$, so Driving Force $F = R$.
                        </div>
                        Driving Force $F = \frac{P}{v} = \frac{20000}{v}$<br>
                        Equating forces ($F=R$):<br>
                        $\frac{20000}{v} = 340 + 4v$ <strong>(M1)</strong>
                    </div>
                    
                    <div class="step-box">
                        <span class="step-title">Solve Equation</span>
                        <div class="explanation">Multiply by $v$ to form a quadratic equation.</div>
                        $20000 = 340v + 4v^2$<br>
                        Rearrange: $4v^2 + 340v - 20000 = 0$ <strong>(DM1)</strong><br>
                        Divide by 4: $v^2 + 85v - 5000 = 0$<br>
                        Factorise: $(v - 40)(v + 125) = 0$<br>
                        Since speed must be positive ($v>0$):<br>
                        <span class="math-eq highlight">$v = 40$ m s$^{-1}$</span> <strong>(A1)</strong>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Constants
        const mass = 1500;
        let currentMode = 'a'; 
        
        // Vars
        let simTime = 0;
        let carX = 0;
        let v = 0;
        let animId;
        let timeScale = 0.5;
        let valP = 0, valR = 0, valF = 0;

        document.getElementById('speedRange').addEventListener('input', function(e) {
            timeScale = parseFloat(e.target.value);
        });

        function resize() {
            if(!canvas.parentElement) return;
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = 300; // Fixed height
            drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btnModeA').className = mode === 'a' ? 'action-btn active' : 'action-btn';
            document.getElementById('btnModeB').className = mode === 'b' ? 'action-btn active' : 'action-btn';
            document.getElementById('content-a').style.display = mode === 'a' ? 'block' : 'none';
            document.getElementById('content-b').style.display = mode === 'b' ? 'block' : 'none';
            resetSim();
        }

        function startSim() {
            if(animId) return;
            simTime = 0;
            document.getElementById('btnStart').disabled = true;
            
            if (currentMode === 'a') {
                v = 32; 
            } else {
                v = 10; // Start slower to show acceleration
            }
            
            let lastTime = performance.now();
            function loop(now) {
                let dt = (now - lastTime) / 1000;
                lastTime = now;
                if(dt > 0.1) dt = 0.1;
                update(dt * timeScale);
                drawFrame();
                animId = requestAnimationFrame(loop);
            }
            animId = requestAnimationFrame(loop);
        }

        function resetSim() {
            cancelAnimationFrame(animId);
            animId = null;
            carX = 0;
            v = (currentMode === 'a') ? 32 : 0;
            document.getElementById('btnStart').disabled = false;
            
            if(currentMode === 'a') updatePhysicsA(0); else updatePhysicsB(0);
            drawFrame();
        }

        function update(dt) {
            carX += v * dt * 15; // Move visual car
            if (carX > canvas.width + 100) carX = -100; 
            if (currentMode === 'a') updatePhysicsA(dt); else updatePhysicsB(dt);
        }

        function updatePhysicsA(dt) {
            let P, R, F;
            // Phase 1: Constant speed 32
            if (simTime < 2) {
                P = 24000; v = 32; R = 750; F = P/v;
            } 
            // Phase 2: Power increased
            else {
                P = 28000; R = 750; F = P/v;
                let a = (F - R) / mass;
                v += a * dt * 20; // Speed up physics for visual effect
                if (v >= 36) v = 36; // Stop at target speed for clarity
            }
            simTime += dt;
            updateDash(P, v, F, R);
        }

        function updatePhysicsB(dt) {
            let P = 20000;
            let R = 340 + 4*v;
            let F = P/v;
            if (v < 1) { F = 2000; R = 340; }
            
            let a = (F - R) / mass;
            v += a * dt * 50; // Faster simulation
            updateDash(P, v, F, R);
        }

        function updateDash(P, v, F, R) {
            document.getElementById('dispP').innerText = (P/1000).toFixed(1);
            document.getElementById('dispV').innerText = v.toFixed(1);
            document.getElementById('dispF').innerText = F.toFixed(0);
            document.getElementById('dispR').innerText = R.toFixed(0);
            valF = F; valR = R;
        }

        function drawFrame() {
            const w = canvas.width; const h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            
            // Road
            const roadY = h * 0.65;
            ctx.fillStyle = '#ecf0f1'; ctx.fillRect(0, 0, w, h);
            ctx.fillStyle = '#bdc3c7'; ctx.fillRect(0, roadY, w, h-roadY);
            ctx.strokeStyle = '#7f8c8d'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, roadY); ctx.lineTo(w, roadY); ctx.stroke();
            
            // Car
            const cw = 100; const ch = 50;
            let cx = carX;
            const cy = roadY - ch - 2;
            
            // Body
            ctx.fillStyle = '#3498db';
            ctx.beginPath(); ctx.roundRect(cx, cy, cw, ch, 8); ctx.fill();
            ctx.fillStyle = '#2980b9';
            ctx.beginPath(); ctx.roundRect(cx+15, cy-20, cw-30, 20, [10,10,0,0]); ctx.fill();
            // Wheels
            ctx.fillStyle = '#333';
            ctx.beginPath(); ctx.arc(cx+20, cy+ch, 10, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(cx+cw-20, cy+ch, 10, 0, Math.PI*2); ctx.fill();
            
            // Force Vectors
            const forceScale = 0.15;
            // Drive
            drawArrow(cx + cw, cy + ch/2, valF * forceScale, 0, '#27ae60', `F=${valF.toFixed(0)}`);
            // Resist
            drawArrow(cx, cy + ch/2, -valR * forceScale, 0, '#e74c3c', `R=${valR.toFixed(0)}`);
        }

        function drawArrow(x, y, len, dy, color, text) {
            if (Math.abs(len) < 5) return;
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + len, y + dy);
            ctx.lineWidth = 3; ctx.strokeStyle = color; ctx.stroke();
            
            const angle = Math.atan2(dy, len);
            const endX = x + len; const endY = y + dy;
            
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - 8 * Math.cos(angle - Math.PI/6), endY - 8 * Math.sin(angle - Math.PI/6));
            ctx.lineTo(endX - 8 * Math.cos(angle + Math.PI/6), endY - 8 * Math.sin(angle + Math.PI/6));
            ctx.fillStyle = color; ctx.fill();
            
            ctx.font = "bold 12px Arial"; ctx.fillStyle = color;
            ctx.textAlign = len > 0 ? "left" : "right";
            ctx.fillText(text, x + len + (len>0?10:-10), y + 5);
        }

        resetSim(); setTimeout(resize, 500);
    </script>
</body>
</html>