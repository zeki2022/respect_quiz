<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q2: Newton's 2nd Law</title>
    
    <!-- 引入公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- V5.0 标准布局 --- */
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 400px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        /* 画布防塌陷 */
        .canvas-container { 
            width: 100%; height: 0; 
            padding-bottom: 45%; /* 适合展示受力图 */
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
            min-height: 350px;
        }
        @media (max-width: 1000px) { .canvas-container { padding-bottom: 60%; } }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 10px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition:0.2s;}
        button.action-btn:hover { background-color: #2980b9; transform:translateY(-2px);}
        button.action-btn.active { background-color: #2c3e50; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        .step-box { 
            border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; 
            background: #fff; border-radius: 8px; border-left: 4px solid #ccc;
            transition: all 0.3s;
        }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .math-eq { 
            font-family: 'Times New Roman', serif; font-size: 1.1em;
            color: #2c3e50; background: #f9f9f9; border: 1px solid #eee;
            padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block;
        }
        .highlight { color: #d35400; font-weight: bold; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：受力分析图 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q2</h3>
                
                <div class="problem-text" style="background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333;">
                    <!-- 图片占位 -->
                    <img src="q2_orig.png" style="max-width:100%; mix-blend-mode:multiply; margin-bottom:10px;" onerror="this.style.display='none'">
                    
                    <strong>Given:</strong> Van ($4500$ kg) pulls Trailer ($350$ kg).<br>
                    Driving Force $DF = 2500$ N.<br>
                    Acceleration $a = 0.4$ ms$^{-2}$.<br>
                    Resistances: Van ($X$ N), Trailer ($120$ N).<br>
                    <strong>Find:</strong> Value of $X$ and Tension $T$.
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:10px; left:10px; font-size:12px; color:#555; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px;">
                        Current View: <span id="viewText" style="font-weight:bold; color:#3498db;">System (Whole)</span>
                    </div>
                </div>

                <div class="controls">
                    <span style="font-size:14px; font-weight:bold; color:#555;">Select FBD View:</span>
                    <button class="action-btn active" onclick="setView('system')" id="btnSys">System (Find X)</button>
                    <button class="action-btn" onclick="setView('trailer')" id="btnTrail">Trailer (Find T)</button>
                    <button class="action-btn" onclick="setView('van')" id="btnVan">Van (Check)</button>
                </div>
            </div>
        </div>

        <!-- 右侧：解题步骤 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <!-- Step 1: System -->
                <div id="step1" class="step-box active">
                    <strong>Step 1: Apply N2L to Entire System</strong><br>
                    Treat Van + Trailer as one object.<br>
                    Internal tension $T$ cancels out.<br>
                    Total Mass $M = 4500 + 350 = 4850$ kg<br>
                    $F_{net} = Ma$<br>
                    $DF - X - 120 = 4850 \times 0.4$<br>
                    $2500 - X - 120 = 1940$<br>
                    $2380 - X = 1940$<br>
                    <span class="math-eq highlight">X = 440 \text{ N}</span>
                </div>

                <!-- Step 2: Trailer -->
                <div id="step2" class="step-box">
                    <strong>Step 2: Apply N2L to Trailer</strong><br>
                    Focus only on the Trailer.<br>
                    Forces: Tension $T$ (forward), Resistance $120$ (back).<br>
                    $F_{net} = m_{trailer} a$<br>
                    $T - 120 = 350 \times 0.4$<br>
                    $T - 120 = 140$<br>
                    <span class="math-eq highlight">T = 260 \text{ N}</span>
                </div>

                <!-- Step 3: Check (Optional) -->
                <div id="step3" class="step-box">
                    <strong>Check: Apply N2L to Van</strong><br>
                    $DF - X - T = m_{van} a$<br>
                    $2500 - 440 - 260 = 1800$<br>
                    $m_{van} a = 4500 \times 0.4 = 1800$<br>
                    <span style="color:#27ae60; font-weight:bold;">LHS = RHS (Verified)</span>
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let currentView = 'system'; // system, trailer, van
        
        // Layout Vars
        let vanX, vanY, vanW, vanH;
        let trailerX, trailerW, trailerH;
        let gap;

        function resize() {
            const pW = canvas.parentElement.clientWidth;
            const pH = canvas.parentElement.clientHeight || 350; // 防塌陷
            canvas.width = pW;
            canvas.height = pH;
            initLayout();
            drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function setView(view) {
            currentView = view;
            
            // Toggle Button Styles
            document.querySelectorAll('.action-btn').forEach(b => b.classList.remove('active'));
            if(view === 'system') {
                document.getElementById('btnSys').classList.add('active');
                document.getElementById('viewText').innerText = "System (Find X)";
                highlightStep(1);
            } else if(view === 'trailer') {
                document.getElementById('btnTrail').classList.add('active');
                document.getElementById('viewText').innerText = "Trailer Only (Find T)";
                highlightStep(2);
            } else {
                document.getElementById('btnVan').classList.add('active');
                document.getElementById('viewText').innerText = "Van Only (Check)";
                highlightStep(3);
            }
            
            drawFrame();
        }
        
        function highlightStep(n) {
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            document.getElementById('step'+n).classList.add('active');
        }

        function initLayout() {
            const w = canvas.width;
            const h = canvas.height;
            const cy = h / 2;
            
            // Responsive sizes
            vanW = w * 0.25;
            vanH = vanW * 0.6;
            trailerW = w * 0.15;
            trailerH = trailerW * 0.7;
            gap = w * 0.1;
            
            // Center the whole system
            const totalW = vanW + gap + trailerW;
            const startX = (w - totalW) / 2;
            
            trailerX = startX;
            vanX = startX + trailerW + gap;
            vanY = cy - vanH/2;
            // Trailer bottom aligned with van bottom roughly
            // Actually let's center them vertically on cy
        }

        function drawFrame() {
            const w = canvas.width;
            const h = canvas.height;
            const cy = h / 2;
            
            ctx.clearRect(0, 0, w, h);
            
            // Ground
            ctx.beginPath();
            ctx.moveTo(0, cy + vanH/2 + 5);
            ctx.lineTo(w, cy + vanH/2 + 5);
            ctx.strokeStyle = '#bdc3c7';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw Objects based on View
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // --- TRAILER ---
            if (currentView === 'system' || currentView === 'trailer') {
                ctx.fillStyle = '#3498db'; // Blue
                ctx.fillRect(trailerX, cy - trailerH/2, trailerW, trailerH);
                ctx.fillStyle = '#fff';
                ctx.fillText("Trailer", trailerX + trailerW/2, cy);
                ctx.fillText("350kg", trailerX + trailerW/2, cy + 15);
                
                // Forces on Trailer
                // 1. Resistance 120N (Left)
                drawArrow(trailerX, cy, trailerX - 60, cy, '#e74c3c', "120N");
                
                // 2. Tension T (Right) - Only in Trailer View
                if (currentView === 'trailer') {
                    drawArrow(trailerX + trailerW, cy, trailerX + trailerW + 60, cy, '#f1c40f', "T");
                }
            }

            // --- VAN ---
            if (currentView === 'system' || currentView === 'van') {
                ctx.fillStyle = '#e67e22'; // Orange
                ctx.fillRect(vanX, cy - vanH/2, vanW, vanH);
                ctx.fillStyle = '#fff';
                ctx.fillText("Van", vanX + vanW/2, cy);
                ctx.fillText("4500kg", vanX + vanW/2, cy + 15);
                
                // Forces on Van
                // 1. Driving Force 2500N (Right)
                drawArrow(vanX + vanW, cy, vanX + vanW + 100, cy, '#2ecc71', "DF 2500N");
                
                // 2. Resistance X (Left)
                drawArrow(vanX, cy - 20, vanX - 80, cy - 20, '#e74c3c', "X"); // Offset Y to avoid clash
                
                // 3. Tension T (Left) - Only in Van View
                if (currentView === 'van') {
                    drawArrow(vanX, cy + 20, vanX - 60, cy + 20, '#f1c40f', "T");
                }
            }
            
            // --- TOW BAR (System View Only) ---
            if (currentView === 'system') {
                ctx.beginPath();
                ctx.moveTo(trailerX + trailerW, cy);
                ctx.lineTo(vanX, cy);
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 4;
                ctx.stroke();
                // T is internal, not shown in system view
            }
            
            // Acceleration Arrow (Global)
            ctx.fillStyle = '#333';
            ctx.fillText("a = 0.4 ms⁻²  >>>", w/2, cy - vanH/2 - 30);
        }
        
        function drawArrow(x1, y1, x2, y2, color, text) {
            const headLen = 10;
            const angle = Math.atan2(y2-y1, x2-x1);
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Head
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI/6), y2 - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI/6), y2 - headLen * Math.sin(angle + Math.PI/6));
            ctx.fillStyle = color;
            ctx.fill();
            
            // Text Label
            if (text) {
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Arial';
                // Position text above or below arrow
                // Determine text align based on direction
                if (x2 > x1) { // Right arrow
                    ctx.textAlign = 'left';
                    ctx.fillText(text, x2 + 5, y2);
                } else { // Left arrow
                    ctx.textAlign = 'right';
                    ctx.fillText(text, x2 - 5, y2);
                }
            }
        }

        // Init
        resize();
        setTimeout(resize, 500);
    </script>
</body>
</html>