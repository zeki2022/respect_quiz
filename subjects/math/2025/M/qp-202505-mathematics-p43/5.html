<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q5: Power & N2L</title>
    
    <!-- 引入公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- V4.5 标准布局 --- */
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 400px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        /* 画布容器 */
        .canvas-container { 
            width: 100%; height: 0; 
            padding-bottom: 50%; 
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
            min-height: 350px;
        }
        @media (max-width: 1000px) { .canvas-container { padding-bottom: 60%; } }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition:0.2s;}
        button.action-btn:hover { transform:translateY(-2px); }
        button.action-btn.active { background-color: #2c3e50; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        .step-box { 
            border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; 
            background: #fff; border-radius: 8px; border-left: 4px solid #ccc;
            transition: all 0.3s;
        }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .math-eq { 
            font-family: 'Times New Roman', serif; font-size: 1.1em;
            color: #2c3e50; background: #f9f9f9; border: 1px solid #eee;
            padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block;
        }
        .highlight { color: #d35400; font-weight: bold; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：受力图 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q5</h3>
                
                <div class="problem-text" style="background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333;">
                    <!-- 图片占位 -->
                    <img src="q5_orig.png" style="max-width:100%; mix-blend-mode:multiply; margin-bottom:10px;" onerror="this.style.display='none'">
                    
                    <strong>Given:</strong> Van ($2500$ kg). Resistance $F_{res} = kv^2$ N. Power $P = 62.5$ kW.<br>
                    <strong>(a)</strong> Max steady speed on horizontal is $50$ ms$^{-1}$. Show $k=0.5$ and find acceleration when $v=25$ ms$^{-1}$.<br>
                    <strong>(b)</strong> Hill with angle $\theta$.<br>
                    - At $v=20$, $a=5a$.<br>
                    - At $v=30$, $a=a$.<br>
                    Find $a$ and $\theta$.
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:10px; left:10px; font-size:12px; color:#555; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px;">
                        Scenario: <span id="viewMode" style="font-weight:bold; color:#3498db;">Part (a) Horizontal</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="action-btn active" id="btnA" onclick="setView('a')">Part (a) Horizontal</button>
                    <button class="action-btn" id="btnB" onclick="setView('b')">Part (b) Inclined</button>
                </div>
            </div>
        </div>

        <!-- 右侧：解题步骤 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <!-- Part (a) -->
                <div id="step1" class="step-box active">
                    <strong>Part (a): Find k & Acceleration (4 marks)</strong><br>
                    <strong>1. Steady speed ($a=0$):</strong><br>
                    $P = Fv \Rightarrow \text{Driving Force } D = \frac{P}{v}$<br>
                    At steady speed: $D = \text{Resistive Force}$<br>
                    $\frac{62500}{50} = k(50)^2$<br>
                    $1250 = 2500k \Rightarrow \mathbf{k = 0.5}$ (Shown)<br><br>
                    <strong>2. Find $a$ when $v=25$:</strong><br>
                    $D = \frac{62500}{25} = 2500$ N<br>
                    $R = 0.5(25)^2 = 312.5$ N<br>
                    Apply Newton's 2nd Law ($F_{net} = ma$):<br>
                    $2500 - 312.5 = 2500a$<br>
                    $2187.5 = 2500a$<br>
                    <span class="math-eq highlight">a = 0.875 \text{ ms}^{-2}</span>
                </div>

                <!-- Part (b) -->
                <div id="step2" class="step-box">
                    <strong>Part (b): Find a & $\theta$ (5 marks)</strong><br>
                    On Incline: $D - R - mg\sin\theta = ma$<br><br>
                    <strong>Case 1 ($v=30, acc=a$):</strong><br>
                    $D = \frac{62500}{30} \approx 2083.3$, $R = 0.5(30)^2 = 450$<br>
                    $2083.3 - 450 - 2500g\sin\theta = 2500a$<br>
                    <span class="math-eq">① $1633.3 - 25000\sin\theta = 2500a$</span><br><br>
                    <strong>Case 2 ($v=20, acc=5a$):</strong><br>
                    $D = \frac{62500}{20} = 3125$, $R = 0.5(20)^2 = 200$<br>
                    $3125 - 200 - 2500g\sin\theta = 2500(5a)$<br>
                    <span class="math-eq">② $2925 - 25000\sin\theta = 12500a$</span><br><br>
                    <strong>Solving Simultaneous Eq:</strong><br>
                    Subtract ① from ② to eliminate $\sin\theta$:<br>
                    $1291.7 = 10000a \Rightarrow \mathbf{a \approx 0.129}$<br>
                    Sub back to find $\theta$:<br>
                    $\mathbf{\theta \approx 3.00^\circ}$
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let mode = 'a'; // 'a' or 'b'
        
        // Layout Vars
        let vanW, vanH, groundY, startX;

        function resize() {
            if(!canvas.parentElement) return;
            const pW = canvas.parentElement.clientWidth;
            const pH = canvas.parentElement.clientHeight || 350; 
            canvas.width = pW;
            canvas.height = pH;
            initLayout();
            drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function setView(m) {
            mode = m;
            document.getElementById('viewMode').innerText = m === 'a' ? "Part (a) Horizontal" : "Part (b) Incline";
            
            document.getElementById('btnA').classList.toggle('active', m === 'a');
            document.getElementById('btnB').classList.toggle('active', m === 'b');
            
            // Toggle step highlight
            document.querySelectorAll('.step-box').forEach(el => el.classList.remove('active'));
            if(m === 'a') document.getElementById('step1').classList.add('active');
            else document.getElementById('step2').classList.add('active');
            
            drawFrame();
        }

        function initLayout() {
            const w = canvas.width;
            const h = canvas.height;
            
            vanW = w * 0.25;
            vanH = vanW * 0.6;
            groundY = h * 0.6;
            startX = w * 0.4;
        }

        function drawFrame() {
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            
            // Setup based on mode
            let angle = (mode === 'a') ? 0 : -15 * (Math.PI / 180); // Visual angle for hill (negative for canvas coord)
            
            ctx.save();
            // Center transformation for rotation
            ctx.translate(startX, groundY);
            ctx.rotate(angle);
            
            // 1. Draw Ground
            ctx.beginPath();
            ctx.moveTo(-startX - 100, 5);
            ctx.lineTo(w + 100, 5);
            ctx.strokeStyle = '#95a5a6';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // 2. Draw Van Body
            const vx = -vanW/2;
            const vy = -vanH;
            
            ctx.fillStyle = '#e67e22'; // Orange
            ctx.fillRect(vx, vy, vanW, vanH);
            ctx.strokeStyle = '#d35400';
            ctx.lineWidth = 2;
            ctx.strokeRect(vx, vy, vanW, vanH);
            
            // Wheels
            ctx.fillStyle = '#333';
            ctx.beginPath(); ctx.arc(vx + 20, 0, 12, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(vx + vanW - 20, 0, 12, 0, Math.PI*2); ctx.fill();
            
            // Text on Van
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText("2500kg", 0, vy + vanH/2 + 5);

            // 3. Draw Forces (Free Body Diagram)
            
            // Driving Force (Forward)
            drawArrow(vanW/2, -vanH/2, vanW/2 + 80, -vanH/2, '#2ecc71', "DF");
            
            // Resistance (Backward)
            drawArrow(-vanW/2, -vanH/2, -vanW/2 - 60, -vanH/2, '#e74c3c', "Res");
            
            // Normal Reaction (Up perpendicular)
            drawArrow(0, -vanH, 0, -vanH - 50, '#3498db', "R");
            
            // Gravity
            // Note: Gravity is vertical DOWN. In our rotated context, we need to rotate it back.
            // Or draw it in global context. Let's draw in local context with counter-rotation.
            
            ctx.restore(); // Restore to global coords to draw Gravity correctly
            
            // Recalculate van center in global coords
            const gx = startX + Math.sin(-angle) * (vanH/2); // Approximate offset
            const gy = groundY - Math.cos(-angle) * (vanH/2);
            
            // Gravity Force (Straight Down)
            drawArrow(startX, groundY - 20, startX, groundY + 80, '#9b59b6', "mg");
            
            // If Incline, show Angle
            if (mode === 'b') {
                ctx.beginPath();
                ctx.moveTo(startX - 150, groundY);
                ctx.lineTo(startX + 150, groundY); // Horizontal Ref
                ctx.strokeStyle = '#ccc';
                ctx.setLineDash([5,5]);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Arc
                ctx.beginPath();
                ctx.arc(startX, groundY, 60, 0, angle, true); // CCW
                ctx.stroke();
                ctx.fillStyle = '#555';
                ctx.fillText("θ", startX + 70, groundY - 10);
                
                // Weight Component text
                ctx.fillStyle = '#9b59b6';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText("Component: mg sinθ", startX + 10, groundY + 70);
            }
        }
        
        function drawArrow(x1, y1, x2, y2, color, text) {
            const headLen = 10;
            const angle = Math.atan2(y2-y1, x2-x1);
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Head
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI/6), y2 - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI/6), y2 - headLen * Math.sin(angle + Math.PI/6));
            ctx.fillStyle = color;
            ctx.fill();
            
            // Label
            if (text) {
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Arial';
                // Avoid text overlapping line
                const tx = x2 + (x2 > x1 ? 10 : -10);
                const ty = y2 + (y2 > y1 ? 15 : -10);
                ctx.textAlign = x2 > x1 ? 'left' : 'right';
                ctx.fillText(text, tx, ty);
            }
        }

        // Double Init
        resize();
        setTimeout(resize, 500);
    </script>
</body>
</html>