<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Q4: Static Equilibrium</title>
    
    <!-- 引入公共样式 -->
    <link rel="stylesheet" href="../../../../../common/css/style.css">
    
    <!-- MathJax 配置 -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- V5.0 标准布局 --- */
        body { padding-top: 60px; padding-bottom: 40px; background-color: #f4f7f6; max-width: none !important; }
        
        .container {
            width: 98%; max-width: 1600px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 400px; 
            gap: 20px; align-items: start;
        }
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        
        .back-arrow {
            position: fixed; top: 15px; left: 15px; z-index: 9999;
            width: 40px; height: 40px; background: rgba(255,255,255,0.9);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; color: #333; font-size: 24px; font-weight: bold;
            font-family: sans-serif; line-height: 1; cursor: pointer;
        }
        
        /* 画布容器 */
        .canvas-container { 
            width: 100%; height: 0; 
            padding-bottom: 50%; /* 留足空间给垂下来的绳子 */
            position: relative; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; margin-bottom: 15px; overflow:hidden; 
            min-height: 350px;
        }
        @media (max-width: 1000px) { .canvas-container { padding-bottom: 70%; } }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .controls { display: flex; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; align-items: center; border:1px solid #eee;}
        button.action-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s;}
        button.action-btn:hover { background-color: #2980b9; transform: translateY(-2px); }
        button.action-btn.active { background-color: #2c3e50; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        
        .solution-panel { max-height: 85vh; overflow-y: auto; padding-right:5px;}
        .step-box { 
            border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px; 
            background: #fff; border-radius: 8px; border-left: 4px solid #ccc;
            transition: all 0.3s;
        }
        .step-box.active { border-left: 4px solid #3498db; background: #f0f9ff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .math-eq { 
            font-family: 'Times New Roman', serif; font-size: 1.1em;
            color: #2c3e50; background: #f9f9f9; border: 1px solid #eee;
            padding: 2px 6px; border-radius: 4px; margin: 2px 0; display: inline-block;
        }
        .highlight { color: #d35400; font-weight: bold; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="back-arrow">‹</a>

    <div class="container">
        <!-- 左侧：图示区 -->
        <div class="left-col">
            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">9709 Math / Mechanics / Q4</h3>
                
                <div class="problem-text" style="background:#e8f4fd; padding:15px; border-left:4px solid #3498db; margin-bottom:15px; font-size:15px; line-height:1.6; color:#333;">
                    <!-- 图片占位 -->
                    <img src="q4_orig.png" style="max-width:100%; mix-blend-mode:multiply; margin-bottom:10px;" onerror="this.style.display='none'">
                    
                    <strong>Given:</strong> System in equilibrium.<br>
                    Block P ($25$ kg), Block Q ($20$ kg), Block R ($m$ kg).<br>
                    Angle $\angle A O \text{ Vertical} = 30^\circ$. Angle $\angle B O Q = \alpha$.<br>
                    <strong>Find:</strong> Value of $m$ and $\alpha$.
                </div>

                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:10px; left:10px; font-size:12px; color:#555; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px;">
                        View: <span id="viewMode" style="font-weight:bold; color:#3498db;">Physical Setup</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="action-btn active" id="btnPhys" onclick="setMode('physical')">Show Physical Setup</button>
                    <button class="action-btn" id="btnForce" onclick="setMode('forces')">Show Forces (FBD)</button>
                </div>
            </div>
        </div>

        <!-- 右侧：解题步骤 -->
        <div class="right-col">
            <div class="card solution-panel">
                
                <!-- Step 1 -->
                <div id="step1" class="step-box active">
                    <strong>Step 1: Identify Forces at O</strong><br>
                    Since pulleys are smooth:<br>
                    1. Tension $T_P = \text{Weight of P} = 25g$<br>
                    2. Tension $T_R = \text{Weight of R} = mg$<br>
                    3. Tension $T_Q = \text{Weight of Q} = 20g$
                </div>

                <!-- Step 2 -->
                <div id="step2" class="step-box">
                    <strong>Step 2: Resolve Forces</strong><br>
                    <strong>Vertical ($\uparrow$):</strong> Upward forces = Downward forces<br>
                    $T_P \cos 30^\circ = T_Q + T_R \cos \alpha$<br>
                    $25g \cos 30^\circ = 20g + mg \cos \alpha$<br>
                    $21.65 = 20 + m \cos \alpha$<br>
                    <span class="math-eq">① $m \cos \alpha = 1.65$</span><br><br>
                    
                    <strong>Horizontal ($\rightarrow$):</strong> Left = Right<br>
                    $T_P \sin 30^\circ = T_R \sin \alpha$<br>
                    $25g \sin 30^\circ = mg \sin \alpha$<br>
                    <span class="math-eq">② $m \sin \alpha = 12.5$</span>
                </div>

                <!-- Step 3 -->
                <div id="step3" class="step-box">
                    <strong>Step 3: Solve for $\alpha$ and $m$</strong><br>
                    Divide ② by ①:<br>
                    $\tan \alpha = \frac{12.5}{1.65} \approx 7.57$<br>
                    <span class="highlight">$\alpha \approx 82.5^\circ$</span><br><br>
                    Substitute into ②:<br>
                    $m = \frac{12.5}{\sin 82.5^\circ} \approx 12.608$<br>
                    <span class="highlight">$m = 12.6$</span>
                </div>

            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Geometry Data
        // Calculated values:
        // alpha = 82.5 deg (From vertical, towards right-down)
        // Note: Since 25cos30 (21.65) > 20, the rope to R must pull DOWN to balance forces?
        // Wait, 25cos30 = 21.65 (Up). Q is 20 (Down).
        // Net vertical is 1.65 Up.
        // So R must pull DOWN.
        // So angle alpha (BOQ) is angle from vertical DOWN.
        // Yes, alpha = 82.5 deg from vertical line OQ.
        
        const angleA = 30 * (Math.PI/180); // Left Up
        const angleB = 82.5 * (Math.PI/180); // Right Down
        
        let mode = 'physical'; // physical or forces

        function resize() {
            if(!canvas.parentElement) return;
            const pW = canvas.parentElement.clientWidth;
            const pH = canvas.parentElement.clientHeight || 400; // 防塌陷
            canvas.width = pW;
            canvas.height = pH;
            drawFrame();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('load', resize);

        function setMode(m) {
            mode = m;
            document.getElementById('viewMode').innerText = m === 'physical' ? "Physical Setup" : "Free Body Diagram at O";
            
            document.getElementById('btnPhys').classList.toggle('active', m === 'physical');
            document.getElementById('btnForce').classList.toggle('active', m === 'forces');
            
            drawFrame();
        }

        function drawFrame() {
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            
            // Origin O at center
            const ox = w / 2;
            const oy = h * 0.4; // Slightly up
            
            // Vector lengths (Scaled)
            const scale = 5; // px per Newton (approx)
            // 25g -> ~250N -> too big. Let's use scale relative to canvas size.
            // Let 25g be 150px length
            const lenP = 150;
            const lenQ = (20/25) * lenP; // 120px
            const lenR = (12.6/25) * lenP; // ~75px
            
            if (mode === 'physical') {
                drawPhysical(ox, oy, lenP, lenQ, lenR);
            } else {
                drawForces(ox, oy, lenP, lenQ, lenR);
            }
        }
        
        function drawPhysical(ox, oy, lenP, lenQ, lenR) {
            // 1. Ceiling / Supports
            // Pulleys are somewhere along the force lines
            
            // Line to A (Up-Left 30 deg from vertical)
            // Vertical is -Y. 30 deg to left is -30 deg.
            const ax = ox + lenP * Math.sin(-angleA);
            const ay = oy - lenP * Math.cos(-angleA);
            
            // Line to B (Down-Right 82.5 deg from vertical)
            // Vertical is +Y. 82.5 deg to right.
            const bx = ox + lenR * Math.sin(angleB);
            const by = oy + lenR * Math.cos(angleB);
            
            // Q hangs straight down
            const qx = ox;
            const qy = oy + lenQ;

            // Draw Strings
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#333';
            
            // String P
            ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(ax, ay); ctx.stroke();
            // String R
            ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(bx, by); ctx.stroke();
            // String Q
            ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(qx, qy); ctx.stroke();
            
            // Draw Pulleys
            drawPulley(ax, ay);
            drawPulley(bx, by);
            
            // Draw Masses (Boxes)
            // P hangs from A (draw string down from A)
            ctx.beginPath(); ctx.moveTo(ax-10, ay); ctx.lineTo(ax-10, ay+40); ctx.stroke();
            drawBox(ax-10, ay+40, 25, '#e67e22', 'P (25)');
            
            // R hangs from B
            ctx.beginPath(); ctx.moveTo(bx+10, by); ctx.lineTo(bx+10, by+30); ctx.stroke();
            drawBox(bx+10, by+30, 18, '#3498db', 'R (m)');
            
            // Q hangs from O
            drawBox(qx, qy, 22, '#9b59b6', 'Q (20)');
            
            // Annotations
            drawAngle(ox, oy, -Math.PI/2, -Math.PI/2 - angleA, "30°");
            drawAngle(ox, oy, Math.PI/2, Math.PI/2 - angleB, "α"); // Angle from vertical down
        }
        
        function drawForces(ox, oy, lenP, lenQ, lenR) {
            // Vector P (Up-Left)
            drawVector(ox, oy, lenP, -Math.PI/2 - angleA, '#e67e22', 'Tp (25g)');
            
            // Vector Q (Down)
            drawVector(ox, oy, lenQ, Math.PI/2, '#9b59b6', 'Tq (20g)');
            
            // Vector R (Down-Right)
            drawVector(ox, oy, lenR, Math.PI/2 - angleB, '#3498db', 'Tr (mg)');
            
            // Dashed Vertical Line
            ctx.setLineDash([5,5]);
            ctx.strokeStyle = '#ccc';
            ctx.beginPath(); ctx.moveTo(ox, oy - 150); ctx.lineTo(ox, oy + 150); ctx.stroke();
            ctx.setLineDash([]);
            
            // Dashed Horizontal Line
            ctx.beginPath(); ctx.moveTo(ox - 100, oy); ctx.lineTo(ox + 100, oy); ctx.stroke();
            
            // Annotations
            ctx.fillStyle = '#555';
            ctx.font = '14px Arial';
            ctx.fillText("O", ox + 10, oy - 10);
        }
        
        function drawVector(x, y, len, angle, color, label) {
            const endX = x + len * Math.cos(angle);
            const endY = y + len * Math.sin(angle);
            
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(endX, endY);
            ctx.lineWidth = 4;
            ctx.strokeStyle = color;
            ctx.stroke();
            
            // Arrowhead
            const head = 10;
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - head * Math.cos(angle - Math.PI/6), endY - head * Math.sin(angle - Math.PI/6));
            ctx.lineTo(endX - head * Math.cos(angle + Math.PI/6), endY - head * Math.sin(angle + Math.PI/6));
            ctx.fillStyle = color;
            ctx.fill();
            
            // Label
            ctx.fillStyle = color;
            ctx.font = 'bold 14px Arial';
            ctx.fillText(label, endX + 10, endY);
        }
        
        function drawPulley(x, y) {
            ctx.fillStyle = '#95a5a6';
            ctx.beginPath(); ctx.arc(x, y, 10, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#333'; ctx.lineWidth = 2; ctx.stroke();
        }
        
        function drawBox(x, y, size, color, label) {
            ctx.fillStyle = color;
            ctx.fillRect(x - size, y, size*2, size*2);
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '12px Arial';
            ctx.fillText(label, x, y + size);
        }
        
        function drawAngle(x, y, startAngle, endAngle, text) {
            ctx.beginPath();
            ctx.arc(x, y, 40, startAngle, endAngle, true); // Counter clockwise?
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.fillStyle = '#555';
            ctx.font = '12px Arial';
            // Text position approx
            const mid = (startAngle + endAngle) / 2;
            ctx.fillText(text, x + 50 * Math.cos(mid), y + 50 * Math.sin(mid));
        }

        setTimeout(resize, 500);
    </script>
</body>
</html>